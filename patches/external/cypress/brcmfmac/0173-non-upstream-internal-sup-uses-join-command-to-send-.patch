From d9e59d54d27d997354f81243d408ef92d6115ef7 Mon Sep 17 00:00:00 2001
From: Carter Chen <carter.chen@infineon.com>
Date: Mon, 19 Dec 2022 00:32:52 -0600
Subject: [PATCH 173/208] non-upstream: internal sup uses join command to send
 (re)assoc req

Fixes: SWLINUX-3089
Signed-off-by: Carter Chen <carter.chen@infineon.com>



---
 drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c
index c7e3f090dbcc..1e67ca13ac24 100644
--- a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c
+++ b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c
@@ -2892,7 +2892,10 @@ brcmf_cfg80211_connect(struct wiphy *wiphy, struct net_device *ndev,
 
 	brcmf_set_join_pref(ifp, &sme->bss_select);
 
-	if (sme->prev_bssid) {
+	/* The internal supplicant judges to use assoc or reassoc itself.
+	 * it is not necessary to specify REASSOC
+	 */
+	if ((sme->prev_bssid) && !brcmf_feat_is_enabled(ifp, BRCMF_FEAT_FWSUP)) {
 		brcmf_dbg(CONN, "Trying to REASSOC\n");
 		join_params_size = sizeof(ext_join_params->assoc_le);
 		err = brcmf_fil_cmd_data_set(ifp, BRCMF_C_REASSOC,
-- 
2.17.1

